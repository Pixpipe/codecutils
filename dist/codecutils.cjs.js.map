{"version":3,"file":"codecutils.cjs.js","sources":["../node_modules/traverse/index.js","../src/main.js"],"sourcesContent":["var traverse = module.exports = function (obj) {\n    return new Traverse(obj);\n};\n\nfunction Traverse (obj) {\n    this.value = obj;\n}\n\nTraverse.prototype.get = function (ps) {\n    var node = this.value;\n    for (var i = 0; i < ps.length; i ++) {\n        var key = ps[i];\n        if (!node || !hasOwnProperty.call(node, key)) {\n            node = undefined;\n            break;\n        }\n        node = node[key];\n    }\n    return node;\n};\n\nTraverse.prototype.has = function (ps) {\n    var node = this.value;\n    for (var i = 0; i < ps.length; i ++) {\n        var key = ps[i];\n        if (!node || !hasOwnProperty.call(node, key)) {\n            return false;\n        }\n        node = node[key];\n    }\n    return true;\n};\n\nTraverse.prototype.set = function (ps, value) {\n    var node = this.value;\n    for (var i = 0; i < ps.length - 1; i ++) {\n        var key = ps[i];\n        if (!hasOwnProperty.call(node, key)) node[key] = {};\n        node = node[key];\n    }\n    node[ps[i]] = value;\n    return value;\n};\n\nTraverse.prototype.map = function (cb) {\n    return walk(this.value, cb, true);\n};\n\nTraverse.prototype.forEach = function (cb) {\n    this.value = walk(this.value, cb, false);\n    return this.value;\n};\n\nTraverse.prototype.reduce = function (cb, init) {\n    var skip = arguments.length === 1;\n    var acc = skip ? this.value : init;\n    this.forEach(function (x) {\n        if (!this.isRoot || !skip) {\n            acc = cb.call(this, acc, x);\n        }\n    });\n    return acc;\n};\n\nTraverse.prototype.paths = function () {\n    var acc = [];\n    this.forEach(function (x) {\n        acc.push(this.path); \n    });\n    return acc;\n};\n\nTraverse.prototype.nodes = function () {\n    var acc = [];\n    this.forEach(function (x) {\n        acc.push(this.node);\n    });\n    return acc;\n};\n\nTraverse.prototype.clone = function () {\n    var parents = [], nodes = [];\n    \n    return (function clone (src) {\n        for (var i = 0; i < parents.length; i++) {\n            if (parents[i] === src) {\n                return nodes[i];\n            }\n        }\n        \n        if (typeof src === 'object' && src !== null) {\n            var dst = copy(src);\n            \n            parents.push(src);\n            nodes.push(dst);\n            \n            forEach(objectKeys(src), function (key) {\n                dst[key] = clone(src[key]);\n            });\n            \n            parents.pop();\n            nodes.pop();\n            return dst;\n        }\n        else {\n            return src;\n        }\n    })(this.value);\n};\n\nfunction walk (root, cb, immutable) {\n    var path = [];\n    var parents = [];\n    var alive = true;\n    \n    return (function walker (node_) {\n        var node = immutable ? copy(node_) : node_;\n        var modifiers = {};\n        \n        var keepGoing = true;\n        \n        var state = {\n            node : node,\n            node_ : node_,\n            path : [].concat(path),\n            parent : parents[parents.length - 1],\n            parents : parents,\n            key : path.slice(-1)[0],\n            isRoot : path.length === 0,\n            level : path.length,\n            circular : null,\n            update : function (x, stopHere) {\n                if (!state.isRoot) {\n                    state.parent.node[state.key] = x;\n                }\n                state.node = x;\n                if (stopHere) keepGoing = false;\n            },\n            'delete' : function (stopHere) {\n                delete state.parent.node[state.key];\n                if (stopHere) keepGoing = false;\n            },\n            remove : function (stopHere) {\n                if (isArray(state.parent.node)) {\n                    state.parent.node.splice(state.key, 1);\n                }\n                else {\n                    delete state.parent.node[state.key];\n                }\n                if (stopHere) keepGoing = false;\n            },\n            keys : null,\n            before : function (f) { modifiers.before = f },\n            after : function (f) { modifiers.after = f },\n            pre : function (f) { modifiers.pre = f },\n            post : function (f) { modifiers.post = f },\n            stop : function () { alive = false },\n            block : function () { keepGoing = false }\n        };\n        \n        if (!alive) return state;\n        \n        function updateState() {\n            if (typeof state.node === 'object' && state.node !== null) {\n                if (!state.keys || state.node_ !== state.node) {\n                    state.keys = objectKeys(state.node)\n                }\n                \n                state.isLeaf = state.keys.length == 0;\n                \n                for (var i = 0; i < parents.length; i++) {\n                    if (parents[i].node_ === node_) {\n                        state.circular = parents[i];\n                        break;\n                    }\n                }\n            }\n            else {\n                state.isLeaf = true;\n                state.keys = null;\n            }\n            \n            state.notLeaf = !state.isLeaf;\n            state.notRoot = !state.isRoot;\n        }\n        \n        updateState();\n        \n        // use return values to update if defined\n        var ret = cb.call(state, state.node);\n        if (ret !== undefined && state.update) state.update(ret);\n        \n        if (modifiers.before) modifiers.before.call(state, state.node);\n        \n        if (!keepGoing) return state;\n        \n        if (typeof state.node == 'object'\n        && state.node !== null && !state.circular) {\n            parents.push(state);\n            \n            updateState();\n            \n            forEach(state.keys, function (key, i) {\n                path.push(key);\n                \n                if (modifiers.pre) modifiers.pre.call(state, state.node[key], key);\n                \n                var child = walker(state.node[key]);\n                if (immutable && hasOwnProperty.call(state.node, key)) {\n                    state.node[key] = child.node;\n                }\n                \n                child.isLast = i == state.keys.length - 1;\n                child.isFirst = i == 0;\n                \n                if (modifiers.post) modifiers.post.call(state, child);\n                \n                path.pop();\n            });\n            parents.pop();\n        }\n        \n        if (modifiers.after) modifiers.after.call(state, state.node);\n        \n        return state;\n    })(root).node;\n}\n\nfunction copy (src) {\n    if (typeof src === 'object' && src !== null) {\n        var dst;\n        \n        if (isArray(src)) {\n            dst = [];\n        }\n        else if (isDate(src)) {\n            dst = new Date(src.getTime ? src.getTime() : src);\n        }\n        else if (isRegExp(src)) {\n            dst = new RegExp(src);\n        }\n        else if (isError(src)) {\n            dst = { message: src.message };\n        }\n        else if (isBoolean(src)) {\n            dst = new Boolean(src);\n        }\n        else if (isNumber(src)) {\n            dst = new Number(src);\n        }\n        else if (isString(src)) {\n            dst = new String(src);\n        }\n        else if (Object.create && Object.getPrototypeOf) {\n            dst = Object.create(Object.getPrototypeOf(src));\n        }\n        else if (src.constructor === Object) {\n            dst = {};\n        }\n        else {\n            var proto =\n                (src.constructor && src.constructor.prototype)\n                || src.__proto__\n                || {}\n            ;\n            var T = function () {};\n            T.prototype = proto;\n            dst = new T;\n        }\n        \n        forEach(objectKeys(src), function (key) {\n            dst[key] = src[key];\n        });\n        return dst;\n    }\n    else return src;\n}\n\nvar objectKeys = Object.keys || function keys (obj) {\n    var res = [];\n    for (var key in obj) res.push(key)\n    return res;\n};\n\nfunction toS (obj) { return Object.prototype.toString.call(obj) }\nfunction isDate (obj) { return toS(obj) === '[object Date]' }\nfunction isRegExp (obj) { return toS(obj) === '[object RegExp]' }\nfunction isError (obj) { return toS(obj) === '[object Error]' }\nfunction isBoolean (obj) { return toS(obj) === '[object Boolean]' }\nfunction isNumber (obj) { return toS(obj) === '[object Number]' }\nfunction isString (obj) { return toS(obj) === '[object String]' }\n\nvar isArray = Array.isArray || function isArray (xs) {\n    return Object.prototype.toString.call(xs) === '[object Array]';\n};\n\nvar forEach = function (xs, fn) {\n    if (xs.forEach) return xs.forEach(fn)\n    else for (var i = 0; i < xs.length; i++) {\n        fn(xs[i], i, xs);\n    }\n};\n\nforEach(objectKeys(Traverse.prototype), function (key) {\n    traverse[key] = function (obj) {\n        var args = [].slice.call(arguments, 1);\n        var t = new Traverse(obj);\n        return t[key].apply(t, args);\n    };\n});\n\nvar hasOwnProperty = Object.hasOwnProperty || function (obj, key) {\n    return key in obj;\n};\n","import traverse from \"traverse\";\n\n/**\n* The CodecUtils class gather some static methods that can be useful while\n* encodeing/decoding data.\n* CodecUtils does not have a constructor, don't try to instanciate it.\n*/\nclass CodecUtils {\n\n\n  /**\n  * Get whether or not the platform is using little endian.\n  * @return {Boolen } true if the platform is little endian, false if big endian\n  */\n  static isPlatformLittleEndian() {\n    var a = new Uint32Array([0x12345678]);\n    var b = new Uint8Array(a.buffer, a.byteOffset, a.byteLength);\n    return (b[0] != 0x12);\n  }\n\n\n  /**\n  * convert an ArrayBuffer into a unicode string (2 bytes for each char)\n  * Note: this method was kindly borrowed from Google Closure Compiler:\n  * https://github.com/google/closure-library/blob/master/closure/goog/crypt/crypt.js\n  * @param {ArrayBuffer} buf - input ArrayBuffer\n  * @return {String} a string compatible with Unicode characters\n  */\n  static arrayBufferToUnicode( buff ) {\n    var buffUint8 = new Uint8Array(buff)\n    var out = [], pos = 0, c = 0;\n    \n    while (pos < buffUint8.length) {\n      var c1 = buffUint8[pos++];\n      if (c1 < 128) {\n        if((c1 < 32 && c1 != 10 && c1 != 13 && c1 != 9) || c1 == 127){\n          console.warn(\"Invalid string: non-printable characters\");\n          return null;\n        }\n        out[c++] = String.fromCharCode(c1);\n      } else if (c1 > 191 && c1 < 224) {\n        var c2 = buffUint8[pos++];\n        out[c++] = String.fromCharCode((c1 & 31) << 6 | c2 & 63);\n      } else if (c1 > 239 && c1 < 365) {\n        // Surrogate Pair\n        var c2 = buffUint8[pos++];\n        var c3 = buffUint8[pos++];\n        var c4 = buffUint8[pos++];\n        var u = ((c1 & 7) << 18 | (c2 & 63) << 12 | (c3 & 63) << 6 | c4 & 63) - 0x10000;\n        out[c++] = String.fromCharCode(0xD800 + (u >> 10));\n        out[c++] = String.fromCharCode(0xDC00 + (u & 1023));\n      } else {\n        var c2 = buffUint8[pos++];\n        var c3 = buffUint8[pos++];\n        var code = (c1 & 15) << 12 | (c2 & 63) << 6 | c3 & 63;\n        if(code === 0xFFFD){\n          console.warn(\"Invalid string: a REPLACEMENT CHARACTER was spotted\");\n          return null;\n        }\n        out[c++] = String.fromCharCode(code);\n      }\n    }\n    return out.join('');\n  };\n\n\n  /**\n  * convert a unicode string into an ArrayBuffer\n  * Note that the str is a regular string but it will be encoded with\n  * 2 bytes per char instead of 1 ( ASCII uses 1 byte/char ).\n  * Note: this method was kindly borrowed from Google Closure Compiler:\n  * https://github.com/google/closure-library/blob/master/closure/goog/crypt/crypt.js\n  * @param {String} str - string to encode\n  * @return {ArrayBuffer} the output ArrayBuffer\n  */\n  static unicodeToArrayBuffer( str ) {\n    var out = [], p = 0;\n    for (var i = 0; i < str.length; i++) {\n      var c = str.charCodeAt(i);\n      if (c < 128) {\n        out[p++] = c;\n      } else if (c < 2048) {\n        out[p++] = (c >> 6) | 192;\n        out[p++] = (c & 63) | 128;\n      } else if (\n          ((c & 0xFC00) == 0xD800) && (i + 1) < str.length &&\n          ((str.charCodeAt(i + 1) & 0xFC00) == 0xDC00)) {\n        // Surrogate Pair\n        c = 0x10000 + ((c & 0x03FF) << 10) + (str.charCodeAt(++i) & 0x03FF);\n        out[p++] = (c >> 18) | 240;\n        out[p++] = ((c >> 12) & 63) | 128;\n        out[p++] = ((c >> 6) & 63) | 128;\n        out[p++] = (c & 63) | 128;\n      } else {\n        out[p++] = (c >> 12) | 224;\n        out[p++] = ((c >> 6) & 63) | 128;\n        out[p++] = (c & 63) | 128;\n      }\n    }\n\n    // make a buffer out of the array\n    return new Uint8Array(out).buffer;\n  };\n\n\n  /**\n  * Convert an ArrayBuffer into a ASCII string (1 byte for each char)\n  * @param {ArrayBuffer} buf - buffer to convert into ASCII string\n  * @return {String} the output string\n  */\n  static arrayBufferToString8( buf ) {\n    return String.fromCharCode.apply(null, new Uint8Array(buf));\n  }\n\n\n  /**\n  * Convert a ASCII string into an ArrayBuffer.\n  * Note that the str is a regular string, it will be encoded with 1 byte per char\n  * @param {String} str - string to encode\n  * @return {ArrayBuffer}\n  */\n  static string8ToArrayBuffer( str ) {\n    var buf = new ArrayBuffer(str.length);\n    var bufView = new Uint8Array(buf);\n    for (var i=0; i < str.length; i++) {\n      bufView[i] = str.charCodeAt(i);\n    }\n    return buf;\n  }\n\n\n  /**\n  * Write a ASCII string into a buffer\n  * @param {String} str - a string that contains only ASCII characters\n  * @param {ArrayBuffer} buffer - the buffer where to write the string\n  * @param {Number} byteOffset - the offset to apply, in number of bytes\n  */\n  static setString8InBuffer( str, buffer, byteOffset = 0 ){\n    if( byteOffset < 0){\n      console.warn(\"The byte offset cannot be negative.\");\n      return;\n    }\n\n    if( !buffer || !(buffer instanceof ArrayBuffer)){\n      console.warn(\"The buffer must be a valid ArrayBuffer.\");\n      return;\n    }\n\n    if( (str.length + byteOffset) > buffer.byteLength ){\n      console.warn(\"The string is too long to be writen in this buffer.\");\n      return;\n    }\n\n    var bufView = new Uint8Array(buffer);\n\n    for (var i=0; i < str.length; i++) {\n      bufView[i + byteOffset] = str.charCodeAt(i);\n    }\n  }\n\n\n  /**\n  * Extract an ASCII string from an ArrayBuffer\n  * @param {ArrayBuffer} buffer - the buffer\n  * @param {Number} strLength - number of chars in the string we want\n  * @param {Number} byteOffset - the offset in number of bytes\n  * @return {String} the string, or null in case of error\n  */\n  static getString8FromBuffer( buffer, strLength, byteOffset=0 ){\n    if( byteOffset < 0){\n      console.warn(\"The byte offset cannot be negative.\");\n      return null;\n    }\n\n    if( !buffer || !(buffer instanceof ArrayBuffer)){\n      console.warn(\"The buffer must be a valid ArrayBuffer.\");\n      return null;\n    }\n\n    if( (strLength + byteOffset) > buffer.byteLength ){\n      console.warn(\"The string is too long to be writen in this buffer.\");\n      return null;\n    }\n\n    return String.fromCharCode.apply(null, new Uint8Array(buffer, byteOffset, strLength));\n  }\n\n\n  /**\n  * Serializes a JS object into an ArrayBuffer.\n  * This is using a unicode JSON intermediate step.\n  * @param {Object} obj - an object that does not have cyclic structure\n  * @return {ArrayBuffer} the serialized output\n  */\n  static objectToArrayBuffer( obj ){\n    var buff = null;\n    var objCleanClone = CodecUtils.makeSerializeFriendly(obj)\n\n    try{\n      var strObj = JSON.stringify( objCleanClone );\n      buff = CodecUtils.unicodeToArrayBuffer(strObj)\n    }catch(e){\n      console.warn(e);\n    }\n\n    return buff;\n  }\n\n\n  /**\n  * Convert an ArrayBuffer into a JS Object. This uses an intermediate unicode JSON string.\n  * Of course, this buffer has to come from a serialized object.\n  * @param {ArrayBuffer} buff - the ArrayBuffer that hides some object\n  * @return {Object} the deserialized object\n  */\n  static ArrayBufferToObject( buff ){\n    var obj = null;\n\n    try{\n      var strObj = CodecUtils.arrayBufferToUnicode( buff );\n      obj = JSON.parse( strObj )\n    }catch(e){\n      console.warn(e);\n    }\n\n    return obj;\n  }\n\n\n  /**\n  * Get if wether of not the arg is a typed array\n  * @param {Object} obj - possibly a typed array, or maybe not\n  * @return {Boolean} true if obj is a typed array\n  */\n  static isTypedArray( obj ){\n    return ( obj instanceof Int8Array         ||\n             obj instanceof Uint8Array        ||\n             obj instanceof Uint8ClampedArray ||\n             obj instanceof Int16Array        ||\n             obj instanceof Uint16Array       ||\n             obj instanceof Int32Array        ||\n             obj instanceof Uint32Array       ||\n             obj instanceof Float32Array      ||\n             obj instanceof Float64Array )\n  }\n\n\n  /**\n  * Merge some ArrayBuffes in a single one\n  * @param {Array} arrayOfBuffers - some ArrayBuffers\n  * @return {ArrayBuffer} the larger merged buffer\n  */\n  static mergeBuffers( arrayOfBuffers ){\n    var totalByteSize = 0;\n\n    for(var i=0; i<arrayOfBuffers.length; i++){\n      totalByteSize += arrayOfBuffers[i].byteLength;\n    }\n\n    var concatArray = new Uint8Array( totalByteSize );\n\n    var offset = 0\n    for(var i=0; i<arrayOfBuffers.length; i++){\n      concatArray.set( new Uint8Array(arrayOfBuffers[i]), offset);\n      offset += arrayOfBuffers[i].byteLength\n    }\n\n    return concatArray.buffer;\n  }\n\n\n  /**\n  * In a browser, the global object is `window` while in Node, it's `GLOBAL`.\n  * This method return the one that is relevant to the execution context.\n  * @return {Object} the global object\n  */\n  static getGlobalObject(){\n    var constructorHost = null;\n\n    try{\n      constructorHost = window; // in a web browser\n    }catch( e ){\n      try{\n        constructorHost = GLOBAL; // in node\n      }catch( e ){\n        console.warn( \"You are not in a Javascript environment?? Weird.\" );\n        return null;\n      }\n    }\n    return constructorHost;\n  }\n\n\n  /**\n  * Extract a typed array from an arbitrary buffer, with an arbitrary offset\n  * @param {ArrayBuffer} buffer - the buffer from which we extract data\n  * @param {Number} byteOffset - offset from the begining of buffer\n  * @param {Function} arrayType - function object, actually the constructor of the output array\n  * @param {Number} numberOfElements - nb of elem we want to fetch from the buffer\n  * @return {TypedArray} output of type given by arg arrayType - this is a copy, not a view\n  */\n  static extractTypedArray( buffer, byteOffset, arrayType, numberOfElements ){\n    if( !buffer ){\n      console.warn(\"Input Buffer is null.\");\n      return null;\n    }\n\n    if(! (buffer instanceof ArrayBuffer) ){\n      console.warn(\"Buffer must be of type ArrayBuffer\");\n      return null;\n    }\n\n    if(numberOfElements <= 0){\n      console.warn(\"The number of elements to fetch must be greater than 0\");\n      return null;\n    }\n\n    if(byteOffset < 0){\n      console.warn(\"The byte offset must be possitive or 0\");\n      return null;\n    }\n\n    if( byteOffset >= buffer.byteLength ){\n      console.warn(\"The offset cannot be larger than the size of the buffer.\");\n      return null;\n    }\n\n    if( arrayType instanceof Function && !(\"BYTES_PER_ELEMENT\" in arrayType)){\n      console.warn(\"ArrayType must be a typed array constructor function.\");\n      return null;\n    }\n\n    if( arrayType.BYTES_PER_ELEMENT * numberOfElements + byteOffset > buffer.byteLength ){\n      console.warn(\"The requested number of elements is too large for this buffer\");\n      return;\n    }\n\n    var slicedBuff = buffer.slice(byteOffset, byteOffset + numberOfElements*arrayType.BYTES_PER_ELEMENT)\n    return new arrayType( slicedBuff )\n  }\n\n\n  /**\n  * Get some info about the given TypedArray\n  * @param {TypedArray} typedArray - one of the typed array\n  * @return {Object} in form of {type: String, signed: Boolean, bytesPerElements: Number, byteLength: Number, length: Number}\n  */\n  static getTypedArrayInfo( typedArray ){\n    var type = null;\n    var signed = false;\n\n    if( typedArray instanceof Int8Array ){\n      type = \"int\";\n      signed = false;\n    }else if( typedArray instanceof Uint8Array ){\n      type = \"int\";\n      signed = true;\n    }else if( typedArray instanceof Uint8ClampedArray ){\n      type = \"int\";\n      signed = true;\n    }else if( typedArray instanceof Int16Array ){\n      type = \"int\";\n      signed = false;\n    }else if( typedArray instanceof Uint16Array ){\n      type = \"int\";\n      signed = true;\n    }else if( typedArray instanceof Int32Array ){\n      type = \"int\";\n      signed = false;\n    }else if( typedArray instanceof Uint32Array ){\n      type = \"int\";\n      signed = true;\n    }else if( typedArray instanceof Float32Array ){\n      type = \"float\";\n      signed = false;\n    }else if( typedArray instanceof Float64Array ){\n      type = \"float\";\n      signed = false;\n    }\n\n    return {\n      type: type,\n      signed: signed,\n      bytesPerElements: typedArray.BYTES_PER_ELEMENT,\n      byteLength: typedArray.byteLength,\n      length: typedArray.length\n    }\n  }\n\n\n  /**\n  * Counts the number of typed array obj has as attributes\n  * @param {Object} obj - an Object\n  * @return {Number} the number of typed array\n  */\n  static howManyTypedArrayAttributes( obj ){\n    var typArrCounter = 0;\n    traverse(obj).forEach(function (x) {\n      typArrCounter += CodecUtils.isTypedArray(x);\n    });\n    return typArrCounter;\n  }\n\n\n  /**\n  * Check if the given object contains any circular reference.\n  * (Circular ref are non serilizable easily, we want to spot them)\n  * @param {Object} obj - An object to check\n  * @return {Boolean} true if obj contains circular refm false if not\n  */\n  static hasCircularReference( obj ){\n    var hasCircular = false;\n    traverse(obj).forEach(function (x) {\n      if (this.circular){\n        hasCircular = true;\n      }\n    });\n    return hasCircular;\n  }\n\n\n  /**\n  * Remove circular dependencies from an object and return a circularRef-free version\n  * of the object (does not change the original obj), of null if no circular ref was found\n  * @param {Object} obj - An object to check\n  * @return {Object} a circular-ref free object copy if any was found, or null if no circ was found\n  */\n  static removeCircularReference( obj ){\n    var hasCircular = false;\n    var noCircRefObj = traverse(obj).map(function (x) {\n      if (this.circular){\n        this.remove();\n        hasCircular = true;\n      }\n    });\n    return hasCircular ? noCircRefObj : null;\n  }\n\n\n  /**\n  * Clone the object and replace the typed array attributes by regular Arrays.\n  * @param {Object} obj - an object to alter\n  * @return {Object} the clone if ant typed array were changed, or null if was obj didnt contain any typed array.\n  */\n  static replaceTypedArrayAttributesByArrays( obj ){\n    var hasTypedArray = false;\n\n    var noTypedArrClone = traverse(obj).map(function (x) {\n      if (CodecUtils.isTypedArray(x)){\n        // here, we cannot call .length directly because traverse.map already serialized\n        // typed arrays into regular objects\n        var origSize = Object.keys(x).length;\n        var untypedArray = new Array( origSize );\n\n        for(var i=0; i<origSize; i++){\n          untypedArray[i] = x[i];\n        }\n        this.update( untypedArray );\n        hasTypedArray = true;\n      }\n    });\n    return hasTypedArray ? noTypedArrClone : null;\n  }\n\n\n  /**\n  * Creates a clone, does not alter the original object.\n  * Remove circular dependencies and replace typed arrays by regular arrays.\n  * Both will make the serialization possible and more reliable.\n  * @param {Object} obj - the object to make serialization friendly\n  * @return {Object} a clean clone, or null if nothing was done\n  */\n  static makeSerializeFriendly( obj ){\n    var newObj = obj;\n    var noCircular = CodecUtils.removeCircularReference(newObj);\n\n    if( noCircular )\n      newObj = noCircular;\n\n    var noTypedArr = CodecUtils.replaceTypedArrayAttributesByArrays(newObj);\n\n    if( noTypedArr )\n      newObj = noTypedArr;\n\n    return newObj;\n  }\n\n\n  /**\n  * Check if a string is valid or not. A string is considered as invalid if it has\n  * unicode \"REPLACEMENT CHARACTER\" or non-printable ASCII characters.\n  * @param {String} str - string to test\n  * @param {Boolean} forceAll - test the whole string instead of a sample of 1000 charaters\n  * @return {Boolean} true is the string is valid, false if invalid.\n  */\n  static isValidString( str, forceAll=false ){\n    var strLen = str.length;\n    var nbSamples = forceAll ? strLen : Math.min( 1000, strLen ); //  a sample of 1000 should be enough\n    var flagChar = 0xFFFD;\n    var redFlags = 0;\n    for(var i=0; i<nbSamples; i++){ \n      var code = str.charCodeAt( Math.floor(Math.random() * nbSamples) );\n      if( code === flagChar || (code < 32 && code != 10 && code != 13 && code != 9) || code == 127){\n        redFlags ++\n      }\n    }\n    return !(redFlags > 0);\n  }\n\n} /* END of class CodecUtils */\n\nexport { CodecUtils }\n"],"names":["CodecUtils","a","Uint32Array","b","Uint8Array","buffer","byteOffset","byteLength","buff","buffUint8","out","pos","c","length","c1","warn","String","fromCharCode","c2","c3","c4","u","code","join","str","p","i","charCodeAt","buf","apply","ArrayBuffer","bufView","strLength","obj","objCleanClone","makeSerializeFriendly","strObj","JSON","stringify","unicodeToArrayBuffer","e","arrayBufferToUnicode","parse","Int8Array","Uint8ClampedArray","Int16Array","Uint16Array","Int32Array","Float32Array","Float64Array","arrayOfBuffers","totalByteSize","concatArray","offset","set","constructorHost","window","GLOBAL","arrayType","numberOfElements","Function","BYTES_PER_ELEMENT","slicedBuff","slice","typedArray","type","signed","typArrCounter","forEach","x","isTypedArray","hasCircular","circular","noCircRefObj","traverse","map","remove","hasTypedArray","noTypedArrClone","origSize","Object","keys","untypedArray","Array","update","newObj","noCircular","removeCircularReference","noTypedArr","replaceTypedArrayAttributesByArrays","forceAll","strLen","nbSamples","Math","min","flagChar","redFlags","floor","random"],"mappings":";;;;;;;;;AAAA,IAAI,QAAQ,GAAG,cAAc,GAAG,UAAU,GAAG,EAAE;IAC3C,OAAO,IAAI,QAAQ,CAAC,GAAG,CAAC,CAAC;CAC5B,CAAC;;AAEF,SAAS,QAAQ,EAAE,GAAG,EAAE;IACpB,IAAI,CAAC,KAAK,GAAG,GAAG,CAAC;CACpB;;AAED,QAAQ,CAAC,SAAS,CAAC,GAAG,GAAG,UAAU,EAAE,EAAE;IACnC,IAAI,IAAI,GAAG,IAAI,CAAC,KAAK,CAAC;IACtB,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,EAAE,CAAC,MAAM,EAAE,CAAC,GAAG,EAAE;QACjC,IAAI,GAAG,GAAG,EAAE,CAAC,CAAC,CAAC,CAAC;QAChB,IAAI,CAAC,IAAI,IAAI,CAAC,cAAc,CAAC,IAAI,CAAC,IAAI,EAAE,GAAG,CAAC,EAAE;YAC1C,IAAI,GAAG,SAAS,CAAC;YACjB,MAAM;SACT;QACD,IAAI,GAAG,IAAI,CAAC,GAAG,CAAC,CAAC;KACpB;IACD,OAAO,IAAI,CAAC;CACf,CAAC;;AAEF,QAAQ,CAAC,SAAS,CAAC,GAAG,GAAG,UAAU,EAAE,EAAE;IACnC,IAAI,IAAI,GAAG,IAAI,CAAC,KAAK,CAAC;IACtB,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,EAAE,CAAC,MAAM,EAAE,CAAC,GAAG,EAAE;QACjC,IAAI,GAAG,GAAG,EAAE,CAAC,CAAC,CAAC,CAAC;QAChB,IAAI,CAAC,IAAI,IAAI,CAAC,cAAc,CAAC,IAAI,CAAC,IAAI,EAAE,GAAG,CAAC,EAAE;YAC1C,OAAO,KAAK,CAAC;SAChB;QACD,IAAI,GAAG,IAAI,CAAC,GAAG,CAAC,CAAC;KACpB;IACD,OAAO,IAAI,CAAC;CACf,CAAC;;AAEF,QAAQ,CAAC,SAAS,CAAC,GAAG,GAAG,UAAU,EAAE,EAAE,KAAK,EAAE;IAC1C,IAAI,IAAI,GAAG,IAAI,CAAC,KAAK,CAAC;IACtB,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,EAAE,CAAC,MAAM,GAAG,CAAC,EAAE,CAAC,GAAG,EAAE;QACrC,IAAI,GAAG,GAAG,EAAE,CAAC,CAAC,CAAC,CAAC;QAChB,IAAI,CAAC,cAAc,CAAC,IAAI,CAAC,IAAI,EAAE,GAAG,CAAC,EAAE,IAAI,CAAC,GAAG,CAAC,GAAG,EAAE,CAAC;QACpD,IAAI,GAAG,IAAI,CAAC,GAAG,CAAC,CAAC;KACpB;IACD,IAAI,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,GAAG,KAAK,CAAC;IACpB,OAAO,KAAK,CAAC;CAChB,CAAC;;AAEF,QAAQ,CAAC,SAAS,CAAC,GAAG,GAAG,UAAU,EAAE,EAAE;IACnC,OAAO,IAAI,CAAC,IAAI,CAAC,KAAK,EAAE,EAAE,EAAE,IAAI,CAAC,CAAC;CACrC,CAAC;;AAEF,QAAQ,CAAC,SAAS,CAAC,OAAO,GAAG,UAAU,EAAE,EAAE;IACvC,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC,IAAI,CAAC,KAAK,EAAE,EAAE,EAAE,KAAK,CAAC,CAAC;IACzC,OAAO,IAAI,CAAC,KAAK,CAAC;CACrB,CAAC;;AAEF,QAAQ,CAAC,SAAS,CAAC,MAAM,GAAG,UAAU,EAAE,EAAE,IAAI,EAAE;IAC5C,IAAI,IAAI,GAAG,SAAS,CAAC,MAAM,KAAK,CAAC,CAAC;IAClC,IAAI,GAAG,GAAG,IAAI,GAAG,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC;IACnC,IAAI,CAAC,OAAO,CAAC,UAAU,CAAC,EAAE;QACtB,IAAI,CAAC,IAAI,CAAC,MAAM,IAAI,CAAC,IAAI,EAAE;YACvB,GAAG,GAAG,EAAE,CAAC,IAAI,CAAC,IAAI,EAAE,GAAG,EAAE,CAAC,CAAC,CAAC;SAC/B;KACJ,CAAC,CAAC;IACH,OAAO,GAAG,CAAC;CACd,CAAC;;AAEF,QAAQ,CAAC,SAAS,CAAC,KAAK,GAAG,YAAY;IACnC,IAAI,GAAG,GAAG,EAAE,CAAC;IACb,IAAI,CAAC,OAAO,CAAC,UAAU,CAAC,EAAE;QACtB,GAAG,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;KACvB,CAAC,CAAC;IACH,OAAO,GAAG,CAAC;CACd,CAAC;;AAEF,QAAQ,CAAC,SAAS,CAAC,KAAK,GAAG,YAAY;IACnC,IAAI,GAAG,GAAG,EAAE,CAAC;IACb,IAAI,CAAC,OAAO,CAAC,UAAU,CAAC,EAAE;QACtB,GAAG,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;KACvB,CAAC,CAAC;IACH,OAAO,GAAG,CAAC;CACd,CAAC;;AAEF,QAAQ,CAAC,SAAS,CAAC,KAAK,GAAG,YAAY;IACnC,IAAI,OAAO,GAAG,EAAE,EAAE,KAAK,GAAG,EAAE,CAAC;;IAE7B,OAAO,CAAC,SAAS,KAAK,EAAE,GAAG,EAAE;QACzB,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,OAAO,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;YACrC,IAAI,OAAO,CAAC,CAAC,CAAC,KAAK,GAAG,EAAE;gBACpB,OAAO,KAAK,CAAC,CAAC,CAAC,CAAC;aACnB;SACJ;;QAED,IAAI,OAAO,GAAG,KAAK,QAAQ,IAAI,GAAG,KAAK,IAAI,EAAE;YACzC,IAAI,GAAG,GAAG,IAAI,CAAC,GAAG,CAAC,CAAC;;YAEpB,OAAO,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;YAClB,KAAK,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;;YAEhB,OAAO,CAAC,UAAU,CAAC,GAAG,CAAC,EAAE,UAAU,GAAG,EAAE;gBACpC,GAAG,CAAC,GAAG,CAAC,GAAG,KAAK,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC,CAAC;aAC9B,CAAC,CAAC;;YAEH,OAAO,CAAC,GAAG,EAAE,CAAC;YACd,KAAK,CAAC,GAAG,EAAE,CAAC;YACZ,OAAO,GAAG,CAAC;SACd;aACI;YACD,OAAO,GAAG,CAAC;SACd;KACJ,EAAE,IAAI,CAAC,KAAK,CAAC,CAAC;CAClB,CAAC;;AAEF,SAAS,IAAI,EAAE,IAAI,EAAE,EAAE,EAAE,SAAS,EAAE;IAChC,IAAI,IAAI,GAAG,EAAE,CAAC;IACd,IAAI,OAAO,GAAG,EAAE,CAAC;IACjB,IAAI,KAAK,GAAG,IAAI,CAAC;;IAEjB,OAAO,CAAC,SAAS,MAAM,EAAE,KAAK,EAAE;QAC5B,IAAI,IAAI,GAAG,SAAS,GAAG,IAAI,CAAC,KAAK,CAAC,GAAG,KAAK,CAAC;QAC3C,IAAI,SAAS,GAAG,EAAE,CAAC;;QAEnB,IAAI,SAAS,GAAG,IAAI,CAAC;;QAErB,IAAI,KAAK,GAAG;YACR,IAAI,GAAG,IAAI;YACX,KAAK,GAAG,KAAK;YACb,IAAI,GAAG,EAAE,CAAC,MAAM,CAAC,IAAI,CAAC;YACtB,MAAM,GAAG,OAAO,CAAC,OAAO,CAAC,MAAM,GAAG,CAAC,CAAC;YACpC,OAAO,GAAG,OAAO;YACjB,GAAG,GAAG,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;YACvB,MAAM,GAAG,IAAI,CAAC,MAAM,KAAK,CAAC;YAC1B,KAAK,GAAG,IAAI,CAAC,MAAM;YACnB,QAAQ,GAAG,IAAI;YACf,MAAM,GAAG,UAAU,CAAC,EAAE,QAAQ,EAAE;gBAC5B,IAAI,CAAC,KAAK,CAAC,MAAM,EAAE;oBACf,KAAK,CAAC,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;iBACpC;gBACD,KAAK,CAAC,IAAI,GAAG,CAAC,CAAC;gBACf,IAAI,QAAQ,EAAE,SAAS,GAAG,KAAK,CAAC;aACnC;YACD,QAAQ,GAAG,UAAU,QAAQ,EAAE;gBAC3B,OAAO,KAAK,CAAC,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;gBACpC,IAAI,QAAQ,EAAE,SAAS,GAAG,KAAK,CAAC;aACnC;YACD,MAAM,GAAG,UAAU,QAAQ,EAAE;gBACzB,IAAI,OAAO,CAAC,KAAK,CAAC,MAAM,CAAC,IAAI,CAAC,EAAE;oBAC5B,KAAK,CAAC,MAAM,CAAC,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,GAAG,EAAE,CAAC,CAAC,CAAC;iBAC1C;qBACI;oBACD,OAAO,KAAK,CAAC,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;iBACvC;gBACD,IAAI,QAAQ,EAAE,SAAS,GAAG,KAAK,CAAC;aACnC;YACD,IAAI,GAAG,IAAI;YACX,MAAM,GAAG,UAAU,CAAC,EAAE,EAAE,SAAS,CAAC,MAAM,GAAG,EAAC,EAAE;YAC9C,KAAK,GAAG,UAAU,CAAC,EAAE,EAAE,SAAS,CAAC,KAAK,GAAG,EAAC,EAAE;YAC5C,GAAG,GAAG,UAAU,CAAC,EAAE,EAAE,SAAS,CAAC,GAAG,GAAG,EAAC,EAAE;YACxC,IAAI,GAAG,UAAU,CAAC,EAAE,EAAE,SAAS,CAAC,IAAI,GAAG,EAAC,EAAE;YAC1C,IAAI,GAAG,YAAY,EAAE,KAAK,GAAG,MAAK,EAAE;YACpC,KAAK,GAAG,YAAY,EAAE,SAAS,GAAG,MAAK,EAAE;SAC5C,CAAC;;QAEF,IAAI,CAAC,KAAK,EAAE,OAAO,KAAK,CAAC;;QAEzB,SAAS,WAAW,GAAG;YACnB,IAAI,OAAO,KAAK,CAAC,IAAI,KAAK,QAAQ,IAAI,KAAK,CAAC,IAAI,KAAK,IAAI,EAAE;gBACvD,IAAI,CAAC,KAAK,CAAC,IAAI,IAAI,KAAK,CAAC,KAAK,KAAK,KAAK,CAAC,IAAI,EAAE;oBAC3C,KAAK,CAAC,IAAI,GAAG,UAAU,CAAC,KAAK,CAAC,IAAI,EAAC;iBACtC;;gBAED,KAAK,CAAC,MAAM,GAAG,KAAK,CAAC,IAAI,CAAC,MAAM,IAAI,CAAC,CAAC;;gBAEtC,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,OAAO,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;oBACrC,IAAI,OAAO,CAAC,CAAC,CAAC,CAAC,KAAK,KAAK,KAAK,EAAE;wBAC5B,KAAK,CAAC,QAAQ,GAAG,OAAO,CAAC,CAAC,CAAC,CAAC;wBAC5B,MAAM;qBACT;iBACJ;aACJ;iBACI;gBACD,KAAK,CAAC,MAAM,GAAG,IAAI,CAAC;gBACpB,KAAK,CAAC,IAAI,GAAG,IAAI,CAAC;aACrB;;YAED,KAAK,CAAC,OAAO,GAAG,CAAC,KAAK,CAAC,MAAM,CAAC;YAC9B,KAAK,CAAC,OAAO,GAAG,CAAC,KAAK,CAAC,MAAM,CAAC;SACjC;;QAED,WAAW,EAAE,CAAC;;;QAGd,IAAI,GAAG,GAAG,EAAE,CAAC,IAAI,CAAC,KAAK,EAAE,KAAK,CAAC,IAAI,CAAC,CAAC;QACrC,IAAI,GAAG,KAAK,SAAS,IAAI,KAAK,CAAC,MAAM,EAAE,KAAK,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC;;QAEzD,IAAI,SAAS,CAAC,MAAM,EAAE,SAAS,CAAC,MAAM,CAAC,IAAI,CAAC,KAAK,EAAE,KAAK,CAAC,IAAI,CAAC,CAAC;;QAE/D,IAAI,CAAC,SAAS,EAAE,OAAO,KAAK,CAAC;;QAE7B,IAAI,OAAO,KAAK,CAAC,IAAI,IAAI,QAAQ;WAC9B,KAAK,CAAC,IAAI,KAAK,IAAI,IAAI,CAAC,KAAK,CAAC,QAAQ,EAAE;YACvC,OAAO,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;;YAEpB,WAAW,EAAE,CAAC;;YAEd,OAAO,CAAC,KAAK,CAAC,IAAI,EAAE,UAAU,GAAG,EAAE,CAAC,EAAE;gBAClC,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;;gBAEf,IAAI,SAAS,CAAC,GAAG,EAAE,SAAS,CAAC,GAAG,CAAC,IAAI,CAAC,KAAK,EAAE,KAAK,CAAC,IAAI,CAAC,GAAG,CAAC,EAAE,GAAG,CAAC,CAAC;;gBAEnE,IAAI,KAAK,GAAG,MAAM,CAAC,KAAK,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC;gBACpC,IAAI,SAAS,IAAI,cAAc,CAAC,IAAI,CAAC,KAAK,CAAC,IAAI,EAAE,GAAG,CAAC,EAAE;oBACnD,KAAK,CAAC,IAAI,CAAC,GAAG,CAAC,GAAG,KAAK,CAAC,IAAI,CAAC;iBAChC;;gBAED,KAAK,CAAC,MAAM,GAAG,CAAC,IAAI,KAAK,CAAC,IAAI,CAAC,MAAM,GAAG,CAAC,CAAC;gBAC1C,KAAK,CAAC,OAAO,GAAG,CAAC,IAAI,CAAC,CAAC;;gBAEvB,IAAI,SAAS,CAAC,IAAI,EAAE,SAAS,CAAC,IAAI,CAAC,IAAI,CAAC,KAAK,EAAE,KAAK,CAAC,CAAC;;gBAEtD,IAAI,CAAC,GAAG,EAAE,CAAC;aACd,CAAC,CAAC;YACH,OAAO,CAAC,GAAG,EAAE,CAAC;SACjB;;QAED,IAAI,SAAS,CAAC,KAAK,EAAE,SAAS,CAAC,KAAK,CAAC,IAAI,CAAC,KAAK,EAAE,KAAK,CAAC,IAAI,CAAC,CAAC;;QAE7D,OAAO,KAAK,CAAC;KAChB,EAAE,IAAI,CAAC,CAAC,IAAI,CAAC;CACjB;;AAED,SAAS,IAAI,EAAE,GAAG,EAAE;IAChB,IAAI,OAAO,GAAG,KAAK,QAAQ,IAAI,GAAG,KAAK,IAAI,EAAE;QACzC,IAAI,GAAG,CAAC;;QAER,IAAI,OAAO,CAAC,GAAG,CAAC,EAAE;YACd,GAAG,GAAG,EAAE,CAAC;SACZ;aACI,IAAI,MAAM,CAAC,GAAG,CAAC,EAAE;YAClB,GAAG,GAAG,IAAI,IAAI,CAAC,GAAG,CAAC,OAAO,GAAG,GAAG,CAAC,OAAO,EAAE,GAAG,GAAG,CAAC,CAAC;SACrD;aACI,IAAI,QAAQ,CAAC,GAAG,CAAC,EAAE;YACpB,GAAG,GAAG,IAAI,MAAM,CAAC,GAAG,CAAC,CAAC;SACzB;aACI,IAAI,OAAO,CAAC,GAAG,CAAC,EAAE;YACnB,GAAG,GAAG,EAAE,OAAO,EAAE,GAAG,CAAC,OAAO,EAAE,CAAC;SAClC;aACI,IAAI,SAAS,CAAC,GAAG,CAAC,EAAE;YACrB,GAAG,GAAG,IAAI,OAAO,CAAC,GAAG,CAAC,CAAC;SAC1B;aACI,IAAI,QAAQ,CAAC,GAAG,CAAC,EAAE;YACpB,GAAG,GAAG,IAAI,MAAM,CAAC,GAAG,CAAC,CAAC;SACzB;aACI,IAAI,QAAQ,CAAC,GAAG,CAAC,EAAE;YACpB,GAAG,GAAG,IAAI,MAAM,CAAC,GAAG,CAAC,CAAC;SACzB;aACI,IAAI,MAAM,CAAC,MAAM,IAAI,MAAM,CAAC,cAAc,EAAE;YAC7C,GAAG,GAAG,MAAM,CAAC,MAAM,CAAC,MAAM,CAAC,cAAc,CAAC,GAAG,CAAC,CAAC,CAAC;SACnD;aACI,IAAI,GAAG,CAAC,WAAW,KAAK,MAAM,EAAE;YACjC,GAAG,GAAG,EAAE,CAAC;SACZ;aACI;YACD,IAAI,KAAK;gBACL,CAAC,GAAG,CAAC,WAAW,IAAI,GAAG,CAAC,WAAW,CAAC,SAAS;mBAC1C,GAAG,CAAC,SAAS;mBACb,EAAE;aACR;YACD,IAAI,CAAC,GAAG,YAAY,EAAE,CAAC;YACvB,CAAC,CAAC,SAAS,GAAG,KAAK,CAAC;YACpB,GAAG,GAAG,IAAI,CAAC,CAAC;SACf;;QAED,OAAO,CAAC,UAAU,CAAC,GAAG,CAAC,EAAE,UAAU,GAAG,EAAE;YACpC,GAAG,CAAC,GAAG,CAAC,GAAG,GAAG,CAAC,GAAG,CAAC,CAAC;SACvB,CAAC,CAAC;QACH,OAAO,GAAG,CAAC;KACd;SACI,OAAO,GAAG,CAAC;CACnB;;AAED,IAAI,UAAU,GAAG,MAAM,CAAC,IAAI,IAAI,SAAS,IAAI,EAAE,GAAG,EAAE;IAChD,IAAI,GAAG,GAAG,EAAE,CAAC;IACb,KAAK,IAAI,GAAG,IAAI,GAAG,EAAE,GAAG,CAAC,IAAI,CAAC,GAAG,EAAC;IAClC,OAAO,GAAG,CAAC;CACd,CAAC;;AAEF,SAAS,GAAG,EAAE,GAAG,EAAE,EAAE,OAAO,MAAM,CAAC,SAAS,CAAC,QAAQ,CAAC,IAAI,CAAC,GAAG,CAAC,EAAE;AACjE,SAAS,MAAM,EAAE,GAAG,EAAE,EAAE,OAAO,GAAG,CAAC,GAAG,CAAC,KAAK,eAAe,EAAE;AAC7D,SAAS,QAAQ,EAAE,GAAG,EAAE,EAAE,OAAO,GAAG,CAAC,GAAG,CAAC,KAAK,iBAAiB,EAAE;AACjE,SAAS,OAAO,EAAE,GAAG,EAAE,EAAE,OAAO,GAAG,CAAC,GAAG,CAAC,KAAK,gBAAgB,EAAE;AAC/D,SAAS,SAAS,EAAE,GAAG,EAAE,EAAE,OAAO,GAAG,CAAC,GAAG,CAAC,KAAK,kBAAkB,EAAE;AACnE,SAAS,QAAQ,EAAE,GAAG,EAAE,EAAE,OAAO,GAAG,CAAC,GAAG,CAAC,KAAK,iBAAiB,EAAE;AACjE,SAAS,QAAQ,EAAE,GAAG,EAAE,EAAE,OAAO,GAAG,CAAC,GAAG,CAAC,KAAK,iBAAiB,EAAE;;AAEjE,IAAI,OAAO,GAAG,KAAK,CAAC,OAAO,IAAI,SAAS,OAAO,EAAE,EAAE,EAAE;IACjD,OAAO,MAAM,CAAC,SAAS,CAAC,QAAQ,CAAC,IAAI,CAAC,EAAE,CAAC,KAAK,gBAAgB,CAAC;CAClE,CAAC;;AAEF,IAAI,OAAO,GAAG,UAAU,EAAE,EAAE,EAAE,EAAE;IAC5B,IAAI,EAAE,CAAC,OAAO,EAAE,OAAO,EAAE,CAAC,OAAO,CAAC,EAAE,CAAC;SAChC,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,EAAE,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;QACrC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC,EAAE,CAAC,EAAE,EAAE,CAAC,CAAC;KACpB;CACJ,CAAC;;AAEF,OAAO,CAAC,UAAU,CAAC,QAAQ,CAAC,SAAS,CAAC,EAAE,UAAU,GAAG,EAAE;IACnD,QAAQ,CAAC,GAAG,CAAC,GAAG,UAAU,GAAG,EAAE;QAC3B,IAAI,IAAI,GAAG,EAAE,CAAC,KAAK,CAAC,IAAI,CAAC,SAAS,EAAE,CAAC,CAAC,CAAC;QACvC,IAAI,CAAC,GAAG,IAAI,QAAQ,CAAC,GAAG,CAAC,CAAC;QAC1B,OAAO,CAAC,CAAC,GAAG,CAAC,CAAC,KAAK,CAAC,CAAC,EAAE,IAAI,CAAC,CAAC;KAChC,CAAC;CACL,CAAC,CAAC;;AAEH,IAAI,cAAc,GAAG,MAAM,CAAC,cAAc,IAAI,UAAU,GAAG,EAAE,GAAG,EAAE;IAC9D,OAAO,GAAG,IAAI,GAAG,CAAC;CACrB,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;ACvTF;;;;;;IAKMA;;;;;;;;;;;;;6CAO4B;UAC1BC,IAAI,IAAIC,WAAJ,CAAgB,CAAC,UAAD,CAAhB,CAAR;UACIC,IAAI,IAAIC,UAAJ,CAAeH,EAAEI,MAAjB,EAAyBJ,EAAEK,UAA3B,EAAuCL,EAAEM,UAAzC,CAAR;aACQJ,EAAE,CAAF,KAAQ,IAAhB;;;;;;;;;;;;;yCAW2BK,MAAO;UAC9BC,YAAY,IAAIL,UAAJ,CAAeI,IAAf,CAAhB;UACIE,MAAM,EAAV;UAAcC,MAAM,CAApB;UAAuBC,IAAI,CAA3B;;aAEOD,MAAMF,UAAUI,MAAvB,EAA+B;YACzBC,KAAKL,UAAUE,KAAV,CAAT;YACIG,KAAK,GAAT,EAAc;cACRA,KAAK,EAAL,IAAWA,MAAM,EAAjB,IAAuBA,MAAM,EAA7B,IAAmCA,MAAM,CAA1C,IAAgDA,MAAM,GAAzD,EAA6D;oBACnDC,IAAR,CAAa,0CAAb;mBACO,IAAP;;cAEEH,GAAJ,IAAWI,OAAOC,YAAP,CAAoBH,EAApB,CAAX;SALF,MAMO,IAAIA,KAAK,GAAL,IAAYA,KAAK,GAArB,EAA0B;cAC3BI,KAAKT,UAAUE,KAAV,CAAT;cACIC,GAAJ,IAAWI,OAAOC,YAAP,CAAoB,CAACH,KAAK,EAAN,KAAa,CAAb,GAAiBI,KAAK,EAA1C,CAAX;SAFK,MAGA,IAAIJ,KAAK,GAAL,IAAYA,KAAK,GAArB,EAA0B;;cAE3BI,KAAKT,UAAUE,KAAV,CAAT;cACIQ,KAAKV,UAAUE,KAAV,CAAT;cACIS,KAAKX,UAAUE,KAAV,CAAT;cACIU,IAAI,CAAC,CAACP,KAAK,CAAN,KAAY,EAAZ,GAAiB,CAACI,KAAK,EAAN,KAAa,EAA9B,GAAmC,CAACC,KAAK,EAAN,KAAa,CAAhD,GAAoDC,KAAK,EAA1D,IAAgE,OAAxE;cACIR,GAAJ,IAAWI,OAAOC,YAAP,CAAoB,UAAUI,KAAK,EAAf,CAApB,CAAX;cACIT,GAAJ,IAAWI,OAAOC,YAAP,CAAoB,UAAUI,IAAI,IAAd,CAApB,CAAX;SAPK,MAQA;cACDH,KAAKT,UAAUE,KAAV,CAAT;cACIQ,KAAKV,UAAUE,KAAV,CAAT;cACIW,OAAO,CAACR,KAAK,EAAN,KAAa,EAAb,GAAkB,CAACI,KAAK,EAAN,KAAa,CAA/B,GAAmCC,KAAK,EAAnD;cACGG,SAAS,MAAZ,EAAmB;oBACTP,IAAR,CAAa,qDAAb;mBACO,IAAP;;cAEEH,GAAJ,IAAWI,OAAOC,YAAP,CAAoBK,IAApB,CAAX;;;aAGGZ,IAAIa,IAAJ,CAAS,EAAT,CAAP;;;;;;;;;;;;;;;yCAa2BC,KAAM;UAC7Bd,MAAM,EAAV;UAAce,IAAI,CAAlB;WACK,IAAIC,IAAI,CAAb,EAAgBA,IAAIF,IAAIX,MAAxB,EAAgCa,GAAhC,EAAqC;YAC/Bd,IAAIY,IAAIG,UAAJ,CAAeD,CAAf,CAAR;YACId,IAAI,GAAR,EAAa;cACPa,GAAJ,IAAWb,CAAX;SADF,MAEO,IAAIA,IAAI,IAAR,EAAc;cACfa,GAAJ,IAAYb,KAAK,CAAN,GAAW,GAAtB;cACIa,GAAJ,IAAYb,IAAI,EAAL,GAAW,GAAtB;SAFK,MAGA,IACF,CAACA,IAAI,MAAL,KAAgB,MAAjB,IAA6Bc,IAAI,CAAL,GAAUF,IAAIX,MAA1C,IACC,CAACW,IAAIG,UAAJ,CAAeD,IAAI,CAAnB,IAAwB,MAAzB,KAAoC,MAFlC,EAE2C;;cAE5C,WAAW,CAACd,IAAI,MAAL,KAAgB,EAA3B,KAAkCY,IAAIG,UAAJ,CAAe,EAAED,CAAjB,IAAsB,MAAxD,CAAJ;cACID,GAAJ,IAAYb,KAAK,EAAN,GAAY,GAAvB;cACIa,GAAJ,IAAab,KAAK,EAAN,GAAY,EAAb,GAAmB,GAA9B;cACIa,GAAJ,IAAab,KAAK,CAAN,GAAW,EAAZ,GAAkB,GAA7B;cACIa,GAAJ,IAAYb,IAAI,EAAL,GAAW,GAAtB;SARK,MASA;cACDa,GAAJ,IAAYb,KAAK,EAAN,GAAY,GAAvB;cACIa,GAAJ,IAAab,KAAK,CAAN,GAAW,EAAZ,GAAkB,GAA7B;cACIa,GAAJ,IAAYb,IAAI,EAAL,GAAW,GAAtB;;;;;aAKG,IAAIR,UAAJ,CAAeM,GAAf,EAAoBL,MAA3B;;;;;;;;;;;yCAS2BuB,KAAM;aAC1BZ,OAAOC,YAAP,CAAoBY,KAApB,CAA0B,IAA1B,EAAgC,IAAIzB,UAAJ,CAAewB,GAAf,CAAhC,CAAP;;;;;;;;;;;;yCAU2BJ,KAAM;UAC7BI,MAAM,IAAIE,WAAJ,CAAgBN,IAAIX,MAApB,CAAV;UACIkB,UAAU,IAAI3B,UAAJ,CAAewB,GAAf,CAAd;WACK,IAAIF,IAAE,CAAX,EAAcA,IAAIF,IAAIX,MAAtB,EAA8Ba,GAA9B,EAAmC;gBACzBA,CAAR,IAAaF,IAAIG,UAAJ,CAAeD,CAAf,CAAb;;aAEKE,GAAP;;;;;;;;;;;;uCAUyBJ,KAAKnB,QAAwB;UAAhBC,UAAgB,uEAAH,CAAG;;UAClDA,aAAa,CAAjB,EAAmB;gBACTS,IAAR,CAAa,qCAAb;;;;UAIE,CAACV,MAAD,IAAW,EAAEA,kBAAkByB,WAApB,CAAf,EAAgD;gBACtCf,IAAR,CAAa,yCAAb;;;;UAIGS,IAAIX,MAAJ,GAAaP,UAAd,GAA4BD,OAAOE,UAAvC,EAAmD;gBACzCQ,IAAR,CAAa,qDAAb;;;;UAIEgB,UAAU,IAAI3B,UAAJ,CAAeC,MAAf,CAAd;;WAEK,IAAIqB,IAAE,CAAX,EAAcA,IAAIF,IAAIX,MAAtB,EAA8Ba,GAA9B,EAAmC;gBACzBA,IAAIpB,UAAZ,IAA0BkB,IAAIG,UAAJ,CAAeD,CAAf,CAA1B;;;;;;;;;;;;;;yCAYyBrB,QAAQ2B,WAAyB;UAAd1B,UAAc,uEAAH,CAAG;;UACxDA,aAAa,CAAjB,EAAmB;gBACTS,IAAR,CAAa,qCAAb;eACO,IAAP;;;UAGE,CAACV,MAAD,IAAW,EAAEA,kBAAkByB,WAApB,CAAf,EAAgD;gBACtCf,IAAR,CAAa,yCAAb;eACO,IAAP;;;UAGGiB,YAAY1B,UAAb,GAA2BD,OAAOE,UAAtC,EAAkD;gBACxCQ,IAAR,CAAa,qDAAb;eACO,IAAP;;;aAGKC,OAAOC,YAAP,CAAoBY,KAApB,CAA0B,IAA1B,EAAgC,IAAIzB,UAAJ,CAAeC,MAAf,EAAuBC,UAAvB,EAAmC0B,SAAnC,CAAhC,CAAP;;;;;;;;;;;;wCAU0BC,KAAK;UAC3BzB,OAAO,IAAX;UACI0B,gBAAgBlC,WAAWmC,qBAAX,CAAiCF,GAAjC,CAApB;;UAEG;YACGG,SAASC,KAAKC,SAAL,CAAgBJ,aAAhB,CAAb;eACOlC,WAAWuC,oBAAX,CAAgCH,MAAhC,CAAP;OAFF,CAGC,OAAMI,CAAN,EAAQ;gBACCzB,IAAR,CAAayB,CAAb;;;aAGKhC,IAAP;;;;;;;;;;;;wCAU0BA,MAAM;UAC5ByB,MAAM,IAAV;;UAEG;YACGG,SAASpC,WAAWyC,oBAAX,CAAiCjC,IAAjC,CAAb;cACM6B,KAAKK,KAAL,CAAYN,MAAZ,CAAN;OAFF,CAGC,OAAMI,CAAN,EAAQ;gBACCzB,IAAR,CAAayB,CAAb;;;aAGKP,GAAP;;;;;;;;;;;iCASmBA,KAAK;aACfA,eAAeU,SAAf,IACAV,eAAe7B,UADf,IAEA6B,eAAeW,iBAFf,IAGAX,eAAeY,UAHf,IAIAZ,eAAea,WAJf,IAKAb,eAAec,UALf,IAMAd,eAAe/B,WANf,IAOA+B,eAAee,YAPf,IAQAf,eAAegB,YARxB;;;;;;;;;;;iCAiBmBC,gBAAgB;UAC/BC,gBAAgB,CAApB;;WAEI,IAAIzB,IAAE,CAAV,EAAaA,IAAEwB,eAAerC,MAA9B,EAAsCa,GAAtC,EAA0C;yBACvBwB,eAAexB,CAAf,EAAkBnB,UAAnC;;;UAGE6C,cAAc,IAAIhD,UAAJ,CAAgB+C,aAAhB,CAAlB;;UAEIE,SAAS,CAAb;WACI,IAAI3B,IAAE,CAAV,EAAaA,IAAEwB,eAAerC,MAA9B,EAAsCa,GAAtC,EAA0C;oBAC5B4B,GAAZ,CAAiB,IAAIlD,UAAJ,CAAe8C,eAAexB,CAAf,CAAf,CAAjB,EAAoD2B,MAApD;kBACUH,eAAexB,CAAf,EAAkBnB,UAA5B;;;aAGK6C,YAAY/C,MAAnB;;;;;;;;;;;sCASsB;UAClBkD,kBAAkB,IAAtB;;UAEG;0BACiBC,MAAlB,CADC;OAAH,CAEC,OAAOhB,CAAP,EAAU;YACN;4BACiBiB,MAAlB,CADC;SAAH,CAEC,OAAOjB,CAAP,EAAU;kBACDzB,IAAR,CAAc,kDAAd;iBACO,IAAP;;;aAGGwC,eAAP;;;;;;;;;;;;;;sCAYwBlD,QAAQC,YAAYoD,WAAWC,kBAAkB;UACrE,CAACtD,MAAL,EAAa;gBACHU,IAAR,CAAa,uBAAb;eACO,IAAP;;;UAGC,EAAGV,kBAAkByB,WAArB,CAAH,EAAsC;gBAC5Bf,IAAR,CAAa,oCAAb;eACO,IAAP;;;UAGC4C,oBAAoB,CAAvB,EAAyB;gBACf5C,IAAR,CAAa,wDAAb;eACO,IAAP;;;UAGCT,aAAa,CAAhB,EAAkB;gBACRS,IAAR,CAAa,wCAAb;eACO,IAAP;;;UAGET,cAAcD,OAAOE,UAAzB,EAAqC;gBAC3BQ,IAAR,CAAa,0DAAb;eACO,IAAP;;;UAGE2C,qBAAqBE,QAArB,IAAiC,EAAE,uBAAuBF,SAAzB,CAArC,EAAyE;gBAC/D3C,IAAR,CAAa,uDAAb;eACO,IAAP;;;UAGE2C,UAAUG,iBAAV,GAA8BF,gBAA9B,GAAiDrD,UAAjD,GAA8DD,OAAOE,UAAzE,EAAqF;gBAC3EQ,IAAR,CAAa,+DAAb;;;;UAIE+C,aAAazD,OAAO0D,KAAP,CAAazD,UAAb,EAAyBA,aAAaqD,mBAAiBD,UAAUG,iBAAjE,CAAjB;aACO,IAAIH,SAAJ,CAAeI,UAAf,CAAP;;;;;;;;;;;sCASwBE,YAAY;UAChCC,OAAO,IAAX;UACIC,SAAS,KAAb;;UAEIF,sBAAsBrB,SAA1B,EAAqC;eAC5B,KAAP;iBACS,KAAT;OAFF,MAGM,IAAIqB,sBAAsB5D,UAA1B,EAAsC;eACnC,KAAP;iBACS,IAAT;OAFI,MAGA,IAAI4D,sBAAsBpB,iBAA1B,EAA6C;eAC1C,KAAP;iBACS,IAAT;OAFI,MAGA,IAAIoB,sBAAsBnB,UAA1B,EAAsC;eACnC,KAAP;iBACS,KAAT;OAFI,MAGA,IAAImB,sBAAsBlB,WAA1B,EAAuC;eACpC,KAAP;iBACS,IAAT;OAFI,MAGA,IAAIkB,sBAAsBjB,UAA1B,EAAsC;eACnC,KAAP;iBACS,KAAT;OAFI,MAGA,IAAIiB,sBAAsB9D,WAA1B,EAAuC;eACpC,KAAP;iBACS,IAAT;OAFI,MAGA,IAAI8D,sBAAsBhB,YAA1B,EAAwC;eACrC,OAAP;iBACS,KAAT;OAFI,MAGA,IAAIgB,sBAAsBf,YAA1B,EAAwC;eACrC,OAAP;iBACS,KAAT;;;aAGK;cACCgB,IADD;gBAEGC,MAFH;0BAGaF,WAAWH,iBAHxB;oBAIOG,WAAWzD,UAJlB;gBAKGyD,WAAWnD;OALrB;;;;;;;;;;;gDAekCoB,KAAK;UACnCkC,gBAAgB,CAApB;iBACSlC,GAAT,EAAcmC,OAAd,CAAsB,UAAUC,CAAV,EAAa;yBAChBrE,WAAWsE,YAAX,CAAwBD,CAAxB,CAAjB;OADF;aAGOF,aAAP;;;;;;;;;;;;yCAU2BlC,KAAK;UAC5BsC,cAAc,KAAlB;iBACStC,GAAT,EAAcmC,OAAd,CAAsB,UAAUC,CAAV,EAAa;YAC7B,KAAKG,QAAT,EAAkB;wBACF,IAAd;;OAFJ;aAKOD,WAAP;;;;;;;;;;;;4CAU8BtC,KAAK;UAC/BsC,cAAc,KAAlB;UACIE,eAAeC,WAASzC,GAAT,EAAc0C,GAAd,CAAkB,UAAUN,CAAV,EAAa;YAC5C,KAAKG,QAAT,EAAkB;eACXI,MAAL;wBACc,IAAd;;OAHe,CAAnB;aAMOL,cAAcE,YAAd,GAA6B,IAApC;;;;;;;;;;;wDAS0CxC,KAAK;UAC3C4C,gBAAgB,KAApB;;UAEIC,kBAAkBJ,WAASzC,GAAT,EAAc0C,GAAd,CAAkB,UAAUN,CAAV,EAAa;YAC/CrE,WAAWsE,YAAX,CAAwBD,CAAxB,CAAJ,EAA+B;;;cAGzBU,WAAWC,OAAOC,IAAP,CAAYZ,CAAZ,EAAexD,MAA9B;cACIqE,eAAe,IAAIC,KAAJ,CAAWJ,QAAX,CAAnB;;eAEI,IAAIrD,IAAE,CAAV,EAAaA,IAAEqD,QAAf,EAAyBrD,GAAzB,EAA6B;yBACdA,CAAb,IAAkB2C,EAAE3C,CAAF,CAAlB;;eAEG0D,MAAL,CAAaF,YAAb;0BACgB,IAAhB;;OAXkB,CAAtB;aAcOL,gBAAgBC,eAAhB,GAAkC,IAAzC;;;;;;;;;;;;;0CAW4B7C,KAAK;UAC7BoD,SAASpD,GAAb;UACIqD,aAAatF,WAAWuF,uBAAX,CAAmCF,MAAnC,CAAjB;;UAEIC,UAAJ,EACED,SAASC,UAAT;;UAEEE,aAAaxF,WAAWyF,mCAAX,CAA+CJ,MAA/C,CAAjB;;UAEIG,UAAJ,EACEH,SAASG,UAAT;;aAEKH,MAAP;;;;;;;;;;;;;kCAWoB7D,KAAqB;UAAhBkE,QAAgB,uEAAP,KAAO;;UACrCC,SAASnE,IAAIX,MAAjB;UACI+E,YAAYF,WAAWC,MAAX,GAAoBE,KAAKC,GAAL,CAAU,IAAV,EAAgBH,MAAhB,CAApC,CAFyC;UAGrCI,WAAW,MAAf;UACIC,WAAW,CAAf;WACI,IAAItE,IAAE,CAAV,EAAaA,IAAEkE,SAAf,EAA0BlE,GAA1B,EAA8B;YACxBJ,OAAOE,IAAIG,UAAJ,CAAgBkE,KAAKI,KAAL,CAAWJ,KAAKK,MAAL,KAAgBN,SAA3B,CAAhB,CAAX;YACItE,SAASyE,QAAT,IAAsBzE,OAAO,EAAP,IAAaA,QAAQ,EAArB,IAA2BA,QAAQ,EAAnC,IAAyCA,QAAQ,CAAvE,IAA6EA,QAAQ,GAAzF,EAA6F;;;;aAIxF,EAAE0E,WAAW,CAAb,CAAP;;;;;;;;"}